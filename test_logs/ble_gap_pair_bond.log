./tests/multi_bluetooth/ble_gap_pair_bond.py on ttyACM1|ttyACM0: 
TRACE ttyACM1|ttyACM0:
   614 i0 : SET BDADDR = (0, b'\x02"2\x07"\xae')
   614 i0 : gap_advertise
   614 i0 : NEXT
  1540 i1 : btstack: mp_bluetooth_init
  1541 i1 : btstack: mp_bluetooth_deinit
  1541 i1 : btstack: Configuring TLV for automatic ER/IR key generation
  1542 i1 : btstack: TLV_GET: tag=0x42544400 buffer_size=60
  1542 i1 : btstack: TLV_GET: tag not found
  1543 i1 : btstack: TLV_GET: tag=0x42544401 buffer_size=60
  1543 i1 : btstack: TLV_GET: tag not found
  1544 i1 : btstack: TLV_GET: tag=0x42544402 buffer_size=60
  1544 i1 : btstack: TLV_GET: tag not found
  1545 i1 : btstack: TLV_GET: tag=0x42544403 buffer_size=60
  1545 i1 : btstack: TLV_GET: tag not found
  1545 i1 : btstack: TLV_GET: tag=0x42544404 buffer_size=60
  1546 i1 : btstack: TLV_GET: tag not found
  1546 i1 : btstack: TLV_GET: tag=0x42544405 buffer_size=60
  1546 i1 : btstack: TLV_GET: tag not found
  1547 i1 : btstack: TLV_GET: tag=0x42544406 buffer_size=60
  1547 i1 : btstack: TLV_GET: tag not found
  1547 i1 : btstack: TLV_GET: tag=0x42544407 buffer_size=60
  1548 i1 : btstack: TLV_GET: tag not found
  1548 i1 : btstack: TLV_GET: tag=0x42544408 buffer_size=60
  1548 i1 : btstack: TLV_GET: tag not found
  1549 i1 : btstack: TLV_GET: tag=0x42544409 buffer_size=60
  1549 i1 : btstack: TLV_GET: tag not found
  1549 i1 : btstack: TLV_GET: tag=0x4254440a buffer_size=60
  1550 i1 : btstack: TLV_GET: tag not found
  1550 i1 : btstack: TLV_GET: tag=0x4254440b buffer_size=60
  1550 i1 : btstack: TLV_GET: tag not found
  1551 i1 : btstack: TLV_GET: tag=0x4254440c buffer_size=60
  1551 i1 : btstack: TLV_GET: tag not found
  1551 i1 : btstack: TLV_GET: tag=0x4254440d buffer_size=60
  1552 i1 : btstack: TLV_GET: tag not found
  1552 i1 : btstack: TLV_GET: tag=0x4254440e buffer_size=60
  1552 i1 : btstack: TLV_GET: tag not found
  1553 i1 : btstack: TLV_GET: tag=0x4254440f buffer_size=60
  1553 i1 : btstack: TLV_GET: tag not found
  1554 i1 : btstack: mp_bluetooth_init: waiting for stack startup
  1755 i1 : btstack: btstack_packet_handler_generic(packet_type=4, packet=20081dcc)
  1755 i1 : btstack:   --> btstack event state 0x01
  1756 i1 : btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
  1756 i1 : btstack:   --> hci transport packet sent
  1757 i1 : btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
  1757 i1 : btstack:   --> hci command complete
  1757 i1 : btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
  1758 i1 : btstack:   --> hci transport packet sent
  1758 i1 : btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
  1759 i1 : btstack:   --> hci command complete
  1759 i1 : btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
  1759 i1 : btstack:   --> hci transport packet sent
  1760 i1 : btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
  1760 i1 : btstack:   --> hci command complete
  1761 i1 : btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
  1761 i1 : btstack:   --> hci transport packet sent
  1762 i1 : btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
  1763 i1 : btstack:   --> hci command complete
  1765 i1 : btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
  1766 i1 : btstack:   --> hci transport packet sent
  1768 i1 : btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
  1769 i1 : btstack:   --> hci command complete
  1770 i1 : btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
  1772 i1 : btstack:   --> hci transport packet sent
  1774 i1 : btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
  1775 i1 : btstack:   --> hci command complete
  1777 i1 : btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
  1778 i1 : btstack:   --> hci transport packet sent
  1781 i1 : btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
  1782 i1 : btstack:   --> hci command complete
  1784 i1 : btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
  1785 i1 : btstack:   --> hci transport packet sent
  1787 i1 : btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
  1788 i1 : btstack:   --> hci command complete
  1791 i1 : btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
  1792 i1 : btstack:   --> hci transport packet sent
  1794 i1 : btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
  1795 i1 : btstack:   --> hci command complete
  1797 i1 : btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
  1798 i1 : btstack:   --> hci transport packet sent
  1800 i1 : btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
  1800 i1 : btstack:   --> hci command complete
  1801 i1 : btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
  1801 i1 : btstack:   --> hci transport packet sent
  1802 i1 : btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
  1802 i1 : btstack:   --> hci command complete
  1803 i1 : btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
  1803 i1 : btstack:   --> hci transport packet sent
  1804 i1 : btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
  1804 i1 : btstack:   --> hci command complete
  1805 i1 : btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
  1805 i1 : btstack:   --> hci transport packet sent
  1806 i1 : btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
  1806 i1 : btstack:   --> hci command complete
  1807 i1 : btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
  1807 i1 : btstack:   --> hci transport packet sent
  1808 i1 : btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
  1808 i1 : btstack:   --> hci command complete
  1809 i1 : btstack: TLV_GET: tag=0x534d4552 buffer_size=16
  1809 i1 : btstack: TLV_GET: tag not found
  1810 i1 : btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
  1810 i1 : btstack:   --> hci transport packet sent
  1811 i1 : btstack: btstack_packet_handler_generic(packet_type=4, packet=20081d6c)
  1811 i1 : btstack:   --> btstack event state 0x02
  1812 i1 : btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
  1813 i1 : btstack:   --> hci transport packet sent
  1813 i1 : btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
  1814 i1 : btstack:   --> hci command complete
  1814 i1 : btstack: TLV_STORE: tag=0x534d4552, size=16
  1816 i1 : btstack: TLV_STORE: data:btstack:  d7btstack:  98btstack:  53btstack:  c3btstack:  56btstack:  26btstack:  afbtstack:  d5btstack:  48btstack:  2ebtstack:  fbbtstack:  9cbtstack:  fdbtstack:  15btstack:  8abtstack:  c0btstack:
  1817 i1 : DEBUG: mp_bluetooth_gap_on_set_secret called: type=0, key_len=4, value_len=16
  1818 i1 : DEBUG: invoke_irq_handler returned mp_const_none (no handler registered) - returning true for default behavior
  1819 i1 : btstack: TLV_STORE: success
  1819 i1 : btstack: TLV_GET: tag=0x534d4952 buffer_size=16
  1819 i1 : btstack: TLV_GET: tag not found
  1820 i1 : btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
  1820 i1 : btstack:   --> hci transport packet sent
  1821 i1 : btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
  1821 i1 : btstack:   --> hci command complete
  1822 i1 : btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
  1822 i1 : btstack:   --> hci transport packet sent
  1823 i1 : btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
  1823 i1 : btstack:   --> hci command complete
  1824 i1 : btstack: TLV_STORE: tag=0x534d4952, size=16
  1825 i1 : btstack: TLV_STORE: data:btstack:  6bbtstack:  f5btstack:  32btstack:  5cbtstack:  a1btstack:  ebbtstack:  18btstack:  8abtstack:  2ebtstack:  21btstack:  6abtstack:  f9btstack:  b1btstack:  12btstack:  fcbtstack:  e0btstack:
  1826 i1 : DEBUG: mp_bluetooth_gap_on_set_secret called: type=0, key_len=4, value_len=16
  1827 i1 : DEBUG: invoke_irq_handler returned mp_const_none (no handler registered) - returning true for default behavior
  1827 i1 : btstack: TLV_STORE: success
  1828 i1 : btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
  1828 i1 : btstack:   --> hci command complete
  1828 i1 : btstack: mp_bluetooth_init: stack startup complete
  1829 i1 : btstack: set_public_address: Using controller's public address.
  1829 i1 : btstack: mp_bluetooth_gatts_register_service_begin
  1830 i1 : btstack: mp_bluetooth_gatts_register_service_end
  1830 i1 : NEXT
  1830 i0 : _IRQ_CENTRAL_CONNECT
  1831 i1 : btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
  1831 i1 : btstack:   --> hci transport packet sent
  1831 i1 : gap_connect
  1831 i1 : btstack: mp_bluetooth_gap_peripheral_connect
  1832 i1 : btstack:   --> btstack error: 0
  1832 i1 : btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
  1833 i1 : btstack:   --> hci command complete
  1833 i1 : btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
  1833 i1 : btstack:   --> hci transport packet sent
  1834 i1 : btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
  1834 i1 : btstack:   --> hci transport packet sent
  1835 i1 : btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
  1835 i1 : btstack:   --> hci command status
  1836 i1 : btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
  1836 i1 : btstack:   --> hci command complete
  1837 i1 : btstack: btstack_packet_handler_generic(packet_type=4, packet=20081bbc)
  1837 i1 : btstack:   --> btstack # conns changed
  1838 i1 : btstack: btstack_packet_handler_security(packet_type=4, packet=20081afc)
  1838 i1 : btstack:   --> security event type: 0xcd
  1839 i1 : btstack: btstack_packet_handler_generic(packet_type=4, packet=20081afc)
  1839 i1 : btstack:   --> hci event type: unknown (0xcd)
  1839 i1 : btstack: TLV_GET: tag=0x42544400 buffer_size=60
  1840 i1 : btstack: TLV_GET: tag not found
  1840 i1 : btstack: TLV_GET: tag=0x42544401 buffer_size=60
  1840 i1 : btstack: TLV_GET: tag not found
  1841 i1 : btstack: TLV_GET: tag=0x42544402 buffer_size=60
  1841 i1 : btstack: TLV_GET: tag not found
  1841 i1 : btstack: TLV_GET: tag=0x42544403 buffer_size=60
  1842 i1 : btstack: TLV_GET: tag not found
  1842 i1 : btstack: TLV_GET: tag=0x42544404 buffer_size=60
  1842 i1 : btstack: TLV_GET: tag not found
  1843 i1 : btstack: TLV_GET: tag=0x42544405 buffer_size=60
  1843 i1 : btstack: TLV_GET: tag not found
  1844 i1 : btstack: TLV_GET: tag=0x42544406 buffer_size=60
  1844 i1 : btstack: TLV_GET: tag not found
  1844 i1 : btstack: TLV_GET: tag=0x42544407 buffer_size=60
  1845 i1 : btstack: TLV_GET: tag not found
  1845 i1 : btstack: TLV_GET: tag=0x42544408 buffer_size=60
  1845 i1 : btstack: TLV_GET: tag not found
  1846 i1 : btstack: TLV_GET: tag=0x42544409 buffer_size=60
  1846 i1 : btstack: TLV_GET: tag not found
  1846 i1 : btstack: TLV_GET: tag=0x4254440a buffer_size=60
  1847 i1 : btstack: TLV_GET: tag not found
  1847 i1 : btstack: TLV_GET: tag=0x4254440b buffer_size=60
  1847 i1 : btstack: TLV_GET: tag not found
  1848 i1 : btstack: TLV_GET: tag=0x4254440c buffer_size=60
  1848 i1 : btstack: TLV_GET: tag not found
  1849 i1 : btstack: TLV_GET: tag=0x4254440d buffer_size=60
  1849 i1 : btstack: TLV_GET: tag not found
  1850 i1 : btstack: TLV_GET: tag=0x4254440e buffer_size=60
  1850 i1 : btstack: TLV_GET: tag not found
  1850 i1 : btstack: TLV_GET: tag=0x4254440f buffer_size=60
  1851 i1 : btstack: TLV_GET: tag not found
  1851 i1 : btstack: btstack_packet_handler_security(packet_type=4, packet=20081afc)
  1852 i1 : btstack:   --> security event type: 0xce
  1852 i1 : btstack: btstack_packet_handler_generic(packet_type=4, packet=20081afc)
  1853 i1 : btstack:   --> hci event type: unknown (0xce)
  1854 i1 : btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
  1854 i1 : btstack:   --> hci le meta
  1854 i1 : btstack: create_active_connection: conn_handle=64
  1855 i1 : _IRQ_PERIPHERAL_CONNECT
  1855 i1 : btstack: btstack_packet_handler_att_server(packet_type=4, packet=20003ee4)
  1856 i1 : btstack:   --> hci att server event type: le_meta/disconnection (0x3e)
  1856 i1 : btstack: btstack_packet_handler_att_server(packet_type=4, packet=20081b74)
  1857 i1 : btstack:   --> att connected
  1857 i1 : btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
  1858 i1 : btstack:   --> hci transport packet sent
  1858 i1 : btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
  1858 i1 : btstack:   --> hci le meta
  1859 i1 : btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
  1859 i1 : btstack:   --> hci command status
  1860 i1 : btstack: mp_bluetooth_gattc_discover_characteristics
  1860 i1 : btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
  1861 i1 : btstack:   --> hci transport packet sent
  1861 i1 : btstack:   --> btstack error: 0
  2062 i1 : btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
  2062 i1 : btstack:   --> hci le meta
  2063 i1 : btstack:   --> gatt characteristic query result
  2063 i1 : btstack:   --> gatt characteristic query result
  2064 i1 : btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
  2064 i1 : btstack:   --> hci transport packet sent
  2165 i1 : btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
  2165 i1 : btstack:   --> hci number of completed packets
  2166 i1 : btstack:   --> gatt characteristic query result
  2166 i1 : btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
  2167 i1 : btstack:   --> hci transport packet sent
  2167 i1 : btstack:   --> gatt characteristic query result
  2168 i1 : _IRQ_GATTC_CHARACTERISTIC_RESULT UUID('00000000-1111-2222-3333-444444444444')
  2168 i1 : btstack:   --> gatt query characteristics complete conn_handle=64 status=0
  2168 i1 : _IRQ_GATTC_CHARACTERISTIC_DONE
  2169 i1 : gap_pair
  2169 i1 : btstack: mp_bluetooth_gap_pair: conn_handle=64
  2170 i1 : btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
  2170 i1 : btstack:   --> hci transport packet sent
  2171 i1 : btstack: btstack_packet_handler_security(packet_type=4, packet=20081bbc)
  2171 i1 : btstack:   --> security event type: 0xd4
  2172 i1 : btstack: btstack_packet_handler_generic(packet_type=4, packet=20081bbc)
  2172 i1 : btstack:   --> enc/auth/pair/bond change (type=0xd4)
  2173 i1 : btstack: find_active_connection: conn_handle=64
  2173 i1 : btstack:   --> iter conn 64
  2173 i1 : btstack:   --> updated conn state: encrypted=0, bonded=0
  2174 i1 : btstack:   --> skipping intermediate encryption event (event_type=212)
  2275 i1 : btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
  2275 i1 : btstack:   --> hci number of completed packets
  2276 i1 : btstack: btstack_packet_handler_security(packet_type=4, packet=20081b24)
  2276 i1 : btstack:   --> security event type: 0xc8
  2277 i1 : btstack: btstack_packet_handler_generic(packet_type=4, packet=20081b24)
  2277 i1 : btstack:   --> just works request, auto-accepting
  2278 i1 : btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
  2278 i1 : btstack:   --> hci transport packet sent
  2278 i1 : btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
  2279 i1 : btstack:   --> hci transport packet sent
  2279 i1 : btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
  2280 i1 : btstack:   --> hci command complete
  2280 i1 : btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
  2281 i1 : btstack:   --> hci command complete
  2281 i1 : btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
  2281 i1 : btstack:   --> hci transport packet sent
  2282 i1 : btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
  2283 i1 : btstack:   --> hci transport packet sent
  2283 i1 : btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
  2283 i1 : btstack:   --> hci command complete
  2284 i1 : btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
  2284 i1 : btstack:   --> hci command complete
  2285 i1 : btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
  2285 i1 : btstack:   --> hci transport packet sent
  2286 i1 : btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
  2286 i1 : btstack:   --> hci transport packet sent
  2387 i1 : btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
  2387 i1 : btstack:   --> hci number of completed packets
  2388 i1 : btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
  2388 i1 : btstack:   --> hci transport packet sent
  2389 i1 : btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
  2389 i1 : btstack:   --> hci transport packet sent
  2390 i1 : btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
  2390 i1 : btstack:   --> hci command complete
  2391 i1 : btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
  2391 i1 : btstack:   --> hci transport packet sent
  2392 i1 : btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
  2392 i1 : btstack:   --> hci command complete
  2393 i1 : btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
  2393 i1 : btstack:   --> hci command complete
  2393 i1 : btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
  2394 i1 : btstack:   --> hci transport packet sent
  2394 i1 : btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
  2395 i1 : btstack:   --> hci command status
  2595 i1 : btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
  2596 i1 : btstack:   --> enc/auth/pair/bond change (type=0x08)
  2596 i1 : btstack: find_active_connection: conn_handle=64
  2597 i1 : btstack:   --> iter conn 64
  2597 i1 : btstack:   --> updated conn state: encrypted=1, bonded=0
  2598 i1 : btstack:   --> skipping intermediate encryption event (event_type=8)
  2598 i1 : btstack: TLV_GET: tag=0x42544400 buffer_size=60
  2598 i1 : btstack: TLV_GET: tag not found
  2599 i1 : btstack: TLV_GET: tag=0x42544401 buffer_size=60
  2599 i1 : btstack: TLV_GET: tag not found
  2599 i1 : btstack: TLV_GET: tag=0x42544402 buffer_size=60
  2600 i1 : btstack: TLV_GET: tag not found
  2600 i1 : btstack: TLV_GET: tag=0x42544403 buffer_size=60
  2600 i1 : btstack: TLV_GET: tag not found
  2601 i1 : btstack: TLV_GET: tag=0x42544404 buffer_size=60
  2601 i1 : btstack: TLV_GET: tag not found
  2602 i1 : btstack: TLV_GET: tag=0x42544405 buffer_size=60
  2602 i1 : btstack: TLV_GET: tag not found
  2602 i1 : btstack: TLV_GET: tag=0x42544406 buffer_size=60
  2602 i1 : btstack: TLV_GET: tag not found
  2603 i1 : btstack: TLV_GET: tag=0x42544407 buffer_size=60
  2603 i1 : btstack: TLV_GET: tag not found
  2604 i1 : btstack: TLV_GET: tag=0x42544408 buffer_size=60
  2604 i1 : btstack: TLV_GET: tag not found
  2604 i1 : btstack: TLV_GET: tag=0x42544409 buffer_size=60
  2605 i1 : btstack: TLV_GET: tag not found
  2605 i1 : btstack: TLV_GET: tag=0x4254440a buffer_size=60
  2605 i1 : btstack: TLV_GET: tag not found
  2606 i1 : btstack: TLV_GET: tag=0x4254440b buffer_size=60
  2606 i1 : btstack: TLV_GET: tag not found
  2606 i1 : btstack: TLV_GET: tag=0x4254440c buffer_size=60
  2607 i1 : btstack: TLV_GET: tag not found
  2607 i1 : btstack: TLV_GET: tag=0x4254440d buffer_size=60
  2607 i1 : btstack: TLV_GET: tag not found
  2608 i1 : btstack: TLV_GET: tag=0x4254440e buffer_size=60
  2608 i1 : btstack: TLV_GET: tag not found
  2608 i1 : btstack: TLV_GET: tag=0x4254440f buffer_size=60
  2609 i1 : btstack: TLV_GET: tag not found
  2609 i1 : btstack: TLV_GET: tag=0x42544400 buffer_size=60
  2609 i1 : btstack: TLV_GET: tag not found
  2610 i1 : btstack: TLV_GET: tag=0x42544401 buffer_size=60
  2610 i1 : btstack: TLV_GET: tag not found
  2610 i1 : btstack: TLV_GET: tag=0x42544402 buffer_size=60
  2611 i1 : btstack: TLV_GET: tag not found
  2611 i1 : btstack: TLV_GET: tag=0x42544403 buffer_size=60
  2611 i1 : btstack: TLV_GET: tag not found
  2612 i1 : btstack: TLV_GET: tag=0x42544404 buffer_size=60
  2612 i1 : btstack: TLV_GET: tag not found
  2612 i1 : btstack: TLV_GET: tag=0x42544405 buffer_size=60
  2613 i1 : btstack: TLV_GET: tag not found
  2615 i1 : btstack: TLV_GET: tag=0x42544406 buffer_size=60
  2616 i1 : btstack: TLV_GET: tag not found
  2618 i1 : btstack: TLV_GET: tag=0x42544407 buffer_size=60
  2619 i1 : btstack: TLV_GET: tag not found
  2620 i1 : btstack: TLV_GET: tag=0x42544408 buffer_size=60
  2621 i1 : btstack: TLV_GET: tag not found
  2623 i1 : btstack: TLV_GET: tag=0x42544409 buffer_size=60
  2624 i1 : btstack: TLV_GET: tag not found
  2626 i1 : btstack: TLV_GET: tag=0x4254440a buffer_size=60
  2627 i1 : btstack: TLV_GET: tag not found
  2629 i1 : btstack: TLV_GET: tag=0x4254440b buffer_size=60
  2630 i1 : btstack: TLV_GET: tag not found
  2632 i1 : btstack: TLV_GET: tag=0x4254440c buffer_size=60
  2633 i1 : btstack: TLV_GET: tag not found
  2635 i1 : btstack: TLV_GET: tag=0x4254440d buffer_size=60
  2636 i1 : btstack: TLV_GET: tag not found
  2637 i1 : btstack: TLV_GET: tag=0x4254440e buffer_size=60
  2638 i1 : btstack: TLV_GET: tag not found
  2639 i1 : btstack: TLV_GET: tag=0x4254440f buffer_size=60
  2640 i1 : btstack: TLV_GET: tag not found
  2642 i1 : btstack: TLV_GET: tag=0x42544400 buffer_size=60
  2643 i1 : btstack: TLV_GET: tag not found
  2645 i1 : btstack: TLV_GET: tag=0x42544401 buffer_size=60
  2646 i1 : btstack: TLV_GET: tag not found
  2648 i1 : btstack: TLV_GET: tag=0x42544402 buffer_size=60
  2650 i1 : btstack: TLV_GET: tag not found
  2651 i1 : btstack: TLV_GET: tag=0x42544403 buffer_size=60
  2653 i1 : btstack: TLV_GET: tag not found
  2655 i1 : btstack: TLV_GET: tag=0x42544404 buffer_size=60
  2655 i1 : btstack: TLV_GET: tag not found
  2656 i1 : btstack: TLV_GET: tag=0x42544405 buffer_size=60
  2656 i1 : btstack: TLV_GET: tag not found
  2656 i1 : btstack: TLV_GET: tag=0x42544406 buffer_size=60
  2657 i1 : btstack: TLV_GET: tag not found
  2657 i1 : btstack: TLV_GET: tag=0x42544407 buffer_size=60
  2658 i1 : btstack: TLV_GET: tag not found
  2658 i1 : btstack: TLV_GET: tag=0x42544408 buffer_size=60
  2658 i1 : btstack: TLV_GET: tag not found
  2659 i1 : btstack: TLV_GET: tag=0x42544409 buffer_size=60
  2659 i1 : btstack: TLV_GET: tag not found
  2659 i1 : btstack: TLV_GET: tag=0x4254440a buffer_size=60
  2660 i1 : btstack: TLV_GET: tag not found
  2660 i1 : btstack: TLV_GET: tag=0x4254440b buffer_size=60
  2660 i1 : btstack: TLV_GET: tag not found
  2661 i1 : btstack: TLV_GET: tag=0x4254440c buffer_size=60
  2661 i1 : btstack: TLV_GET: tag not found
  2661 i1 : btstack: TLV_GET: tag=0x4254440d buffer_size=60
  2662 i1 : btstack: TLV_GET: tag not found
  2662 i1 : btstack: TLV_GET: tag=0x4254440e buffer_size=60
  2662 i1 : btstack: TLV_GET: tag not found
  2663 i1 : btstack: TLV_GET: tag=0x4254440f buffer_size=60
  2663 i1 : btstack: TLV_GET: tag not found
  2663 i1 : btstack: TLV_STORE: tag=0x4254440f, size=60
  2665 i1 : btstack: TLV_STORE: data:btstack:  01btstack:  00btstack:  00btstack:  00btstack:  00btstack:  00btstack:  00btstack:  00btstack:  02btstack:  22btstack:  32btstack:  07btstack:  22btstack:  aebtstack:  b8btstack:  1ebtstack: ...btstack:
  2666 i1 : DEBUG: mp_bluetooth_gap_on_set_secret called: type=0, key_len=4, value_len=60
  2666 i1 : DEBUG: invoke_irq_handler returned: 1e, is_true: 1
  2666 i1 : btstack: TLV_STORE: success
  2667 i1 : btstack: TLV_GET: tag=0x4254440f buffer_size=60
  2668 i1 : btstack: TLV_GET: found zu bytes:btstack:  01btstack:  00btstack:  00btstack:  00btstack:  00btstack:  00btstack:  00btstack:  00btstack:  02btstack:  22btstack:  32btstack:  07btstack:  22btstack:  aebtstack:  b8btstack:  1ebtstack: ...btstack:
  2669 i1 : btstack: btstack_packet_handler_security(packet_type=4, packet=20081ac4)
  2669 i1 : btstack:   --> security event type: 0xd3
  2670 i1 : btstack: btstack_packet_handler_generic(packet_type=4, packet=20081ac4)
  2670 i1 : btstack:   --> hci event type: unknown (0xd3)
  2671 i1 : btstack: TLV_GET: tag=0x4254440f buffer_size=60
  2672 i1 : btstack: TLV_GET: found zu bytes:btstack:  01btstack:  00btstack:  00btstack:  00btstack:  00btstack:  00btstack:  00btstack:  00btstack:  02btstack:  22btstack:  32btstack:  07btstack:  22btstack:  aebtstack:  b8btstack:  1ebtstack: ...btstack:
  2673 i1 : btstack: TLV_STORE: tag=0x4254440f, size=60
  2675 i1 : btstack: TLV_STORE: data:btstack:  01btstack:  00btstack:  00btstack:  00btstack:  00btstack:  00btstack:  00btstack:  00btstack:  02btstack:  22btstack:  32btstack:  07btstack:  22btstack:  aebtstack:  b8btstack:  1ebtstack: ...btstack:
  2675 i1 : DEBUG: mp_bluetooth_gap_on_set_secret called: type=0, key_len=4, value_len=60
  2676 i1 : DEBUG: invoke_irq_handler returned: 1e, is_true: 1
  2676 i1 : btstack: TLV_STORE: success
  2676 i1 : btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
  2677 i1 : btstack:   --> hci transport packet sent
  2677 i1 : btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
  2678 i1 : btstack:   --> hci transport packet sent
  2678 i1 : btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
  2679 i1 : btstack:   --> hci command complete
  2679 i1 : btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
  2679 i1 : btstack:   --> hci command complete
  2680 i1 : btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
  2680 i1 : btstack:   --> hci transport packet sent
  2681 i1 : btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
  2681 i1 : btstack:   --> hci transport packet sent
  2682 i1 : btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
  2682 i1 : btstack:   --> hci command complete
  2683 i1 : btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
  2683 i1 : btstack:   --> hci transport packet sent
  2684 i1 : btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
  2684 i1 : btstack:   --> hci command complete
  2684 i1 : btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
  2685 i1 : btstack:   --> hci command complete
  2685 i1 : btstack: btstack_packet_handler_security(packet_type=4, packet=200816b0)
  2686 i1 : btstack:   --> security event type: 0xd5
  2686 i1 : btstack: btstack_packet_handler_generic(packet_type=4, packet=200816b0)
  2687 i1 : btstack:   --> enc/auth/pair/bond change (type=0xd5)
  2687 i1 : btstack: find_active_connection: conn_handle=64
  2687 i1 : btstack:   --> iter conn 64
  2688 i1 : btstack:   --> updated conn state: encrypted=1, bonded=1
  2688 i1 : btstack: find_encryption_state: conn_handle=64
  2689 i1 : btstack: create_encryption_state: conn_handle=64
  2689 i1 : btstack:   --> pairing complete, forwarding final encryption state to Python
  2690 i1 : _IRQ_ENCRYPTION_UPDATE 1 0 1
  2690 i1 : btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
  2690 i1 : btstack:   --> hci transport packet sent
  2691 i1 : btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
  2691 i1 : btstack:   --> hci transport packet sent
  2692 i1 : btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
  2692 i1 : btstack:   --> hci transport packet sent
  2693 i1 : btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
  2693 i1 : btstack:   --> hci transport packet sent
  2693 i1 : gattc_read
  2694 i1 : btstack: mp_bluetooth_gattc_read
  2694 i1 : btstack: find_active_connection: conn_handle=64
  2694 i1 : btstack:   --> iter conn 64
  2695 i1 : btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
  2695 i1 : btstack:   --> hci transport packet sent
  2695 i1 : btstack:   --> btstack error: 0
  2796 i0 : _IRQ_ENCRYPTION_UPDATE 1 0 1
  2797 i1 : btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
  2797 i0 : _IRQ_GATTS_READ_REQUEST
  2797 i1 : btstack:   --> hci number of completed packets
  2798 i1 : btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
  2798 i1 : btstack:   --> hci number of completed packets
  2799 i1 : btstack:   --> gatt characteristic value query result
  2799 i1 : _IRQ_GATTC_READ_RESULT b'encrypted'
  2800 i1 : btstack:   --> gatt query read complete conn_handle=64 status=0
  2800 i1 : btstack: find_active_connection: conn_handle=64
  2800 i1 : btstack:   --> iter conn 64
  2801 i1 : btstack: mp_bluetooth_gap_disconnect
  2801 i1 : btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
  2802 i1 : btstack:   --> hci transport packet sent
  2802 i1 : gap_disconnect: True
  2802 i1 : btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
  2803 i1 : btstack:   --> hci command status
  2904 i1 : btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
  2904 i1 : btstack:   --> hci number of completed packets
  2905 i1 : btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
  2905 i1 : btstack:   --> hci disconnect complete
  2905 i1 : _IRQ_PERIPHERAL_DISCONNECT
  2906 i1 : btstack: remove_encryption_state: conn_handle=64
  2906 i1 : btstack: find_encryption_state: conn_handle=64
  2906 i1 : btstack:   --> iter state 64
  2907 i1 : btstack: remove_active_connection: conn_handle=64
  2907 i1 : btstack: find_active_connection: conn_handle=64
  2907 i1 : btstack:   --> iter conn 64
  2908 i1 : btstack: att_write_callback (handle: 0, mode: 3, offset: 0, buffer: 0, size: 0)
  2908 i1 : btstack: att_write_callback handle not found
  2909 i1 : btstack: btstack_packet_handler_att_server(packet_type=4, packet=20081b74)
  2909 i1 : btstack:   --> att disconnected
  2910 i1 : btstack: btstack_packet_handler_att_server(packet_type=4, packet=20003ee4)
  2910 i1 : btstack:   --> hci att server event type: le_meta/disconnection (0x05)
  2911 i1 : btstack: btstack_packet_handler_generic(packet_type=4, packet=20081bbc)
  2911 i1 : btstack:   --> btstack # conns changed
  2911 i1 : btstack: mp_bluetooth_deinit
  2912 i1 : btstack: mp_bluetooth_gap_advertise_stop
  2912 i1 : btstack: btstack_packet_handler_generic(packet_type=4, packet=20081d14)
  2913 i1 : btstack:   --> btstack event state 0x03
  2913 i1 : btstack: btstack_packet_handler_generic(packet_type=4, packet=20081d14)
  2914 i1 : btstack:   --> btstack event state 0x03
  2914 i1 : btstack: mp_bluetooth_deinit: complete
  3015 i0 : _IRQ_CENTRAL_DISCONNECT
FAIL
### TEST ###
--- instance0 ---
gap_advertise
_IRQ_CENTRAL_CONNECT
_IRQ_ENCRYPTION_UPDATE 1 0 1
_IRQ_GATTS_READ_REQUEST
_IRQ_CENTRAL_DISCONNECT
--- instance1 ---
btstack: mp_bluetooth_init
btstack: mp_bluetooth_deinit
btstack: Configuring TLV for automatic ER/IR key generation
btstack: TLV_GET: tag=0x42544400 buffer_size=60
btstack: TLV_GET: tag not found
btstack: TLV_GET: tag=0x42544401 buffer_size=60
btstack: TLV_GET: tag not found
btstack: TLV_GET: tag=0x42544402 buffer_size=60
btstack: TLV_GET: tag not found
btstack: TLV_GET: tag=0x42544403 buffer_size=60
btstack: TLV_GET: tag not found
btstack: TLV_GET: tag=0x42544404 buffer_size=60
btstack: TLV_GET: tag not found
btstack: TLV_GET: tag=0x42544405 buffer_size=60
btstack: TLV_GET: tag not found
btstack: TLV_GET: tag=0x42544406 buffer_size=60
btstack: TLV_GET: tag not found
btstack: TLV_GET: tag=0x42544407 buffer_size=60
btstack: TLV_GET: tag not found
btstack: TLV_GET: tag=0x42544408 buffer_size=60
btstack: TLV_GET: tag not found
btstack: TLV_GET: tag=0x42544409 buffer_size=60
btstack: TLV_GET: tag not found
btstack: TLV_GET: tag=0x4254440a buffer_size=60
btstack: TLV_GET: tag not found
btstack: TLV_GET: tag=0x4254440b buffer_size=60
btstack: TLV_GET: tag not found
btstack: TLV_GET: tag=0x4254440c buffer_size=60
btstack: TLV_GET: tag not found
btstack: TLV_GET: tag=0x4254440d buffer_size=60
btstack: TLV_GET: tag not found
btstack: TLV_GET: tag=0x4254440e buffer_size=60
btstack: TLV_GET: tag not found
btstack: TLV_GET: tag=0x4254440f buffer_size=60
btstack: TLV_GET: tag not found
btstack: mp_bluetooth_init: waiting for stack startup
btstack: btstack_packet_handler_generic(packet_type=4, packet=20081dcc)
btstack:   --> btstack event state 0x01
btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
btstack:   --> hci transport packet sent
btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
btstack:   --> hci command complete
btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
btstack:   --> hci transport packet sent
btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
btstack:   --> hci command complete
btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
btstack:   --> hci transport packet sent
btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
btstack:   --> hci command complete
btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
btstack:   --> hci transport packet sent
btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
btstack:   --> hci command complete
btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
btstack:   --> hci transport packet sent
btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
btstack:   --> hci command complete
btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
btstack:   --> hci transport packet sent
btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
btstack:   --> hci command complete
btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
btstack:   --> hci transport packet sent
btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
btstack:   --> hci command complete
btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
btstack:   --> hci transport packet sent
btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
btstack:   --> hci command complete
btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
btstack:   --> hci transport packet sent
btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
btstack:   --> hci command complete
btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
btstack:   --> hci transport packet sent
btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
btstack:   --> hci command complete
btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
btstack:   --> hci transport packet sent
btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
btstack:   --> hci command complete
btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
btstack:   --> hci transport packet sent
btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
btstack:   --> hci command complete
btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
btstack:   --> hci transport packet sent
btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
btstack:   --> hci command complete
btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
btstack:   --> hci transport packet sent
btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
btstack:   --> hci command complete
btstack: TLV_GET: tag=0x534d4552 buffer_size=16
btstack: TLV_GET: tag not found
btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
btstack:   --> hci transport packet sent
btstack: btstack_packet_handler_generic(packet_type=4, packet=20081d6c)
btstack:   --> btstack event state 0x02
btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
btstack:   --> hci transport packet sent
btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
btstack:   --> hci command complete
btstack: TLV_STORE: tag=0x534d4552, size=16
btstack: TLV_STORE: data:btstack:  d7btstack:  98btstack:  53btstack:  c3btstack:  56btstack:  26btstack:  afbtstack:  d5btstack:  48btstack:  2ebtstack:  fbbtstack:  9cbtstack:  fdbtstack:  15btstack:  8abtstack:  c0btstack:
DEBUG: mp_bluetooth_gap_on_set_secret called: type=0, key_len=4, value_len=16
DEBUG: invoke_irq_handler returned mp_const_none (no handler registered) - returning true for default behavior
btstack: TLV_STORE: success
btstack: TLV_GET: tag=0x534d4952 buffer_size=16
btstack: TLV_GET: tag not found
btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
btstack:   --> hci transport packet sent
btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
btstack:   --> hci command complete
btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
btstack:   --> hci transport packet sent
btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
btstack:   --> hci command complete
btstack: TLV_STORE: tag=0x534d4952, size=16
btstack: TLV_STORE: data:btstack:  6bbtstack:  f5btstack:  32btstack:  5cbtstack:  a1btstack:  ebbtstack:  18btstack:  8abtstack:  2ebtstack:  21btstack:  6abtstack:  f9btstack:  b1btstack:  12btstack:  fcbtstack:  e0btstack:
DEBUG: mp_bluetooth_gap_on_set_secret called: type=0, key_len=4, value_len=16
DEBUG: invoke_irq_handler returned mp_const_none (no handler registered) - returning true for default behavior
btstack: TLV_STORE: success
btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
btstack:   --> hci command complete
btstack: mp_bluetooth_init: stack startup complete
btstack: set_public_address: Using controller's public address.
btstack: mp_bluetooth_gatts_register_service_begin
btstack: mp_bluetooth_gatts_register_service_end
btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
btstack:   --> hci transport packet sent
gap_connect
btstack: mp_bluetooth_gap_peripheral_connect
btstack:   --> btstack error: 0
btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
btstack:   --> hci command complete
btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
btstack:   --> hci transport packet sent
btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
btstack:   --> hci transport packet sent
btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
btstack:   --> hci command status
btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
btstack:   --> hci command complete
btstack: btstack_packet_handler_generic(packet_type=4, packet=20081bbc)
btstack:   --> btstack # conns changed
btstack: btstack_packet_handler_security(packet_type=4, packet=20081afc)
btstack:   --> security event type: 0xcd
btstack: btstack_packet_handler_generic(packet_type=4, packet=20081afc)
btstack:   --> hci event type: unknown (0xcd)
btstack: TLV_GET: tag=0x42544400 buffer_size=60
btstack: TLV_GET: tag not found
btstack: TLV_GET: tag=0x42544401 buffer_size=60
btstack: TLV_GET: tag not found
btstack: TLV_GET: tag=0x42544402 buffer_size=60
btstack: TLV_GET: tag not found
btstack: TLV_GET: tag=0x42544403 buffer_size=60
btstack: TLV_GET: tag not found
btstack: TLV_GET: tag=0x42544404 buffer_size=60
btstack: TLV_GET: tag not found
btstack: TLV_GET: tag=0x42544405 buffer_size=60
btstack: TLV_GET: tag not found
btstack: TLV_GET: tag=0x42544406 buffer_size=60
btstack: TLV_GET: tag not found
btstack: TLV_GET: tag=0x42544407 buffer_size=60
btstack: TLV_GET: tag not found
btstack: TLV_GET: tag=0x42544408 buffer_size=60
btstack: TLV_GET: tag not found
btstack: TLV_GET: tag=0x42544409 buffer_size=60
btstack: TLV_GET: tag not found
btstack: TLV_GET: tag=0x4254440a buffer_size=60
btstack: TLV_GET: tag not found
btstack: TLV_GET: tag=0x4254440b buffer_size=60
btstack: TLV_GET: tag not found
btstack: TLV_GET: tag=0x4254440c buffer_size=60
btstack: TLV_GET: tag not found
btstack: TLV_GET: tag=0x4254440d buffer_size=60
btstack: TLV_GET: tag not found
btstack: TLV_GET: tag=0x4254440e buffer_size=60
btstack: TLV_GET: tag not found
btstack: TLV_GET: tag=0x4254440f buffer_size=60
btstack: TLV_GET: tag not found
btstack: btstack_packet_handler_security(packet_type=4, packet=20081afc)
btstack:   --> security event type: 0xce
btstack: btstack_packet_handler_generic(packet_type=4, packet=20081afc)
btstack:   --> hci event type: unknown (0xce)
btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
btstack:   --> hci le meta
btstack: create_active_connection: conn_handle=64
_IRQ_PERIPHERAL_CONNECT
btstack: btstack_packet_handler_att_server(packet_type=4, packet=20003ee4)
btstack:   --> hci att server event type: le_meta/disconnection (0x3e)
btstack: btstack_packet_handler_att_server(packet_type=4, packet=20081b74)
btstack:   --> att connected
btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
btstack:   --> hci transport packet sent
btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
btstack:   --> hci le meta
btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
btstack:   --> hci command status
btstack: mp_bluetooth_gattc_discover_characteristics
btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
btstack:   --> hci transport packet sent
btstack:   --> btstack error: 0
btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
btstack:   --> hci le meta
btstack:   --> gatt characteristic query result
btstack:   --> gatt characteristic query result
btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
btstack:   --> hci transport packet sent
btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
btstack:   --> hci number of completed packets
btstack:   --> gatt characteristic query result
btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
btstack:   --> hci transport packet sent
btstack:   --> gatt characteristic query result
_IRQ_GATTC_CHARACTERISTIC_RESULT UUID('00000000-1111-2222-3333-444444444444')
btstack:   --> gatt query characteristics complete conn_handle=64 status=0
_IRQ_GATTC_CHARACTERISTIC_DONE
gap_pair
btstack: mp_bluetooth_gap_pair: conn_handle=64
btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
btstack:   --> hci transport packet sent
btstack: btstack_packet_handler_security(packet_type=4, packet=20081bbc)
btstack:   --> security event type: 0xd4
btstack: btstack_packet_handler_generic(packet_type=4, packet=20081bbc)
btstack:   --> enc/auth/pair/bond change (type=0xd4)
btstack: find_active_connection: conn_handle=64
btstack:   --> iter conn 64
btstack:   --> updated conn state: encrypted=0, bonded=0
btstack:   --> skipping intermediate encryption event (event_type=212)
btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
btstack:   --> hci number of completed packets
btstack: btstack_packet_handler_security(packet_type=4, packet=20081b24)
btstack:   --> security event type: 0xc8
btstack: btstack_packet_handler_generic(packet_type=4, packet=20081b24)
btstack:   --> just works request, auto-accepting
btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
btstack:   --> hci transport packet sent
btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
btstack:   --> hci transport packet sent
btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
btstack:   --> hci command complete
btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
btstack:   --> hci command complete
btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
btstack:   --> hci transport packet sent
btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
btstack:   --> hci transport packet sent
btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
btstack:   --> hci command complete
btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
btstack:   --> hci command complete
btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
btstack:   --> hci transport packet sent
btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
btstack:   --> hci transport packet sent
btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
btstack:   --> hci number of completed packets
btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
btstack:   --> hci transport packet sent
btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
btstack:   --> hci transport packet sent
btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
btstack:   --> hci command complete
btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
btstack:   --> hci transport packet sent
btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
btstack:   --> hci command complete
btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
btstack:   --> hci command complete
btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
btstack:   --> hci transport packet sent
btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
btstack:   --> hci command status
btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
btstack:   --> enc/auth/pair/bond change (type=0x08)
btstack: find_active_connection: conn_handle=64
btstack:   --> iter conn 64
btstack:   --> updated conn state: encrypted=1, bonded=0
btstack:   --> skipping intermediate encryption event (event_type=8)
btstack: TLV_GET: tag=0x42544400 buffer_size=60
btstack: TLV_GET: tag not found
btstack: TLV_GET: tag=0x42544401 buffer_size=60
btstack: TLV_GET: tag not found
btstack: TLV_GET: tag=0x42544402 buffer_size=60
btstack: TLV_GET: tag not found
btstack: TLV_GET: tag=0x42544403 buffer_size=60
btstack: TLV_GET: tag not found
btstack: TLV_GET: tag=0x42544404 buffer_size=60
btstack: TLV_GET: tag not found
btstack: TLV_GET: tag=0x42544405 buffer_size=60
btstack: TLV_GET: tag not found
btstack: TLV_GET: tag=0x42544406 buffer_size=60
btstack: TLV_GET: tag not found
btstack: TLV_GET: tag=0x42544407 buffer_size=60
btstack: TLV_GET: tag not found
btstack: TLV_GET: tag=0x42544408 buffer_size=60
btstack: TLV_GET: tag not found
btstack: TLV_GET: tag=0x42544409 buffer_size=60
btstack: TLV_GET: tag not found
btstack: TLV_GET: tag=0x4254440a buffer_size=60
btstack: TLV_GET: tag not found
btstack: TLV_GET: tag=0x4254440b buffer_size=60
btstack: TLV_GET: tag not found
btstack: TLV_GET: tag=0x4254440c buffer_size=60
btstack: TLV_GET: tag not found
btstack: TLV_GET: tag=0x4254440d buffer_size=60
btstack: TLV_GET: tag not found
btstack: TLV_GET: tag=0x4254440e buffer_size=60
btstack: TLV_GET: tag not found
btstack: TLV_GET: tag=0x4254440f buffer_size=60
btstack: TLV_GET: tag not found
btstack: TLV_GET: tag=0x42544400 buffer_size=60
btstack: TLV_GET: tag not found
btstack: TLV_GET: tag=0x42544401 buffer_size=60
btstack: TLV_GET: tag not found
btstack: TLV_GET: tag=0x42544402 buffer_size=60
btstack: TLV_GET: tag not found
btstack: TLV_GET: tag=0x42544403 buffer_size=60
btstack: TLV_GET: tag not found
btstack: TLV_GET: tag=0x42544404 buffer_size=60
btstack: TLV_GET: tag not found
btstack: TLV_GET: tag=0x42544405 buffer_size=60
btstack: TLV_GET: tag not found
btstack: TLV_GET: tag=0x42544406 buffer_size=60
btstack: TLV_GET: tag not found
btstack: TLV_GET: tag=0x42544407 buffer_size=60
btstack: TLV_GET: tag not found
btstack: TLV_GET: tag=0x42544408 buffer_size=60
btstack: TLV_GET: tag not found
btstack: TLV_GET: tag=0x42544409 buffer_size=60
btstack: TLV_GET: tag not found
btstack: TLV_GET: tag=0x4254440a buffer_size=60
btstack: TLV_GET: tag not found
btstack: TLV_GET: tag=0x4254440b buffer_size=60
btstack: TLV_GET: tag not found
btstack: TLV_GET: tag=0x4254440c buffer_size=60
btstack: TLV_GET: tag not found
btstack: TLV_GET: tag=0x4254440d buffer_size=60
btstack: TLV_GET: tag not found
btstack: TLV_GET: tag=0x4254440e buffer_size=60
btstack: TLV_GET: tag not found
btstack: TLV_GET: tag=0x4254440f buffer_size=60
btstack: TLV_GET: tag not found
btstack: TLV_GET: tag=0x42544400 buffer_size=60
btstack: TLV_GET: tag not found
btstack: TLV_GET: tag=0x42544401 buffer_size=60
btstack: TLV_GET: tag not found
btstack: TLV_GET: tag=0x42544402 buffer_size=60
btstack: TLV_GET: tag not found
btstack: TLV_GET: tag=0x42544403 buffer_size=60
btstack: TLV_GET: tag not found
btstack: TLV_GET: tag=0x42544404 buffer_size=60
btstack: TLV_GET: tag not found
btstack: TLV_GET: tag=0x42544405 buffer_size=60
btstack: TLV_GET: tag not found
btstack: TLV_GET: tag=0x42544406 buffer_size=60
btstack: TLV_GET: tag not found
btstack: TLV_GET: tag=0x42544407 buffer_size=60
btstack: TLV_GET: tag not found
btstack: TLV_GET: tag=0x42544408 buffer_size=60
btstack: TLV_GET: tag not found
btstack: TLV_GET: tag=0x42544409 buffer_size=60
btstack: TLV_GET: tag not found
btstack: TLV_GET: tag=0x4254440a buffer_size=60
btstack: TLV_GET: tag not found
btstack: TLV_GET: tag=0x4254440b buffer_size=60
btstack: TLV_GET: tag not found
btstack: TLV_GET: tag=0x4254440c buffer_size=60
btstack: TLV_GET: tag not found
btstack: TLV_GET: tag=0x4254440d buffer_size=60
btstack: TLV_GET: tag not found
btstack: TLV_GET: tag=0x4254440e buffer_size=60
btstack: TLV_GET: tag not found
btstack: TLV_GET: tag=0x4254440f buffer_size=60
btstack: TLV_GET: tag not found
btstack: TLV_STORE: tag=0x4254440f, size=60
btstack: TLV_STORE: data:btstack:  01btstack:  00btstack:  00btstack:  00btstack:  00btstack:  00btstack:  00btstack:  00btstack:  02btstack:  22btstack:  32btstack:  07btstack:  22btstack:  aebtstack:  b8btstack:  1ebtstack: ...btstack:
DEBUG: mp_bluetooth_gap_on_set_secret called: type=0, key_len=4, value_len=60
DEBUG: invoke_irq_handler returned: 1e, is_true: 1
btstack: TLV_STORE: success
btstack: TLV_GET: tag=0x4254440f buffer_size=60
btstack: TLV_GET: found zu bytes:btstack:  01btstack:  00btstack:  00btstack:  00btstack:  00btstack:  00btstack:  00btstack:  00btstack:  02btstack:  22btstack:  32btstack:  07btstack:  22btstack:  aebtstack:  b8btstack:  1ebtstack: ...btstack:
btstack: btstack_packet_handler_security(packet_type=4, packet=20081ac4)
btstack:   --> security event type: 0xd3
btstack: btstack_packet_handler_generic(packet_type=4, packet=20081ac4)
btstack:   --> hci event type: unknown (0xd3)
btstack: TLV_GET: tag=0x4254440f buffer_size=60
btstack: TLV_GET: found zu bytes:btstack:  01btstack:  00btstack:  00btstack:  00btstack:  00btstack:  00btstack:  00btstack:  00btstack:  02btstack:  22btstack:  32btstack:  07btstack:  22btstack:  aebtstack:  b8btstack:  1ebtstack: ...btstack:
btstack: TLV_STORE: tag=0x4254440f, size=60
btstack: TLV_STORE: data:btstack:  01btstack:  00btstack:  00btstack:  00btstack:  00btstack:  00btstack:  00btstack:  00btstack:  02btstack:  22btstack:  32btstack:  07btstack:  22btstack:  aebtstack:  b8btstack:  1ebtstack: ...btstack:
DEBUG: mp_bluetooth_gap_on_set_secret called: type=0, key_len=4, value_len=60
DEBUG: invoke_irq_handler returned: 1e, is_true: 1
btstack: TLV_STORE: success
btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
btstack:   --> hci transport packet sent
btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
btstack:   --> hci transport packet sent
btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
btstack:   --> hci command complete
btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
btstack:   --> hci command complete
btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
btstack:   --> hci transport packet sent
btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
btstack:   --> hci transport packet sent
btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
btstack:   --> hci command complete
btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
btstack:   --> hci transport packet sent
btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
btstack:   --> hci command complete
btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
btstack:   --> hci command complete
btstack: btstack_packet_handler_security(packet_type=4, packet=200816b0)
btstack:   --> security event type: 0xd5
btstack: btstack_packet_handler_generic(packet_type=4, packet=200816b0)
btstack:   --> enc/auth/pair/bond change (type=0xd5)
btstack: find_active_connection: conn_handle=64
btstack:   --> iter conn 64
btstack:   --> updated conn state: encrypted=1, bonded=1
btstack: find_encryption_state: conn_handle=64
btstack: create_encryption_state: conn_handle=64
btstack:   --> pairing complete, forwarding final encryption state to Python
_IRQ_ENCRYPTION_UPDATE 1 0 1
btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
btstack:   --> hci transport packet sent
btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
btstack:   --> hci transport packet sent
btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
btstack:   --> hci transport packet sent
btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
btstack:   --> hci transport packet sent
gattc_read
btstack: mp_bluetooth_gattc_read
btstack: find_active_connection: conn_handle=64
btstack:   --> iter conn 64
btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
btstack:   --> hci transport packet sent
btstack:   --> btstack error: 0
btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
btstack:   --> hci number of completed packets
btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
btstack:   --> hci number of completed packets
btstack:   --> gatt characteristic value query result
_IRQ_GATTC_READ_RESULT b'encrypted'
btstack:   --> gatt query read complete conn_handle=64 status=0
btstack: find_active_connection: conn_handle=64
btstack:   --> iter conn 64
btstack: mp_bluetooth_gap_disconnect
btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
btstack:   --> hci transport packet sent
gap_disconnect: True
btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
btstack:   --> hci command status
btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
btstack:   --> hci number of completed packets
btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
btstack:   --> hci disconnect complete
_IRQ_PERIPHERAL_DISCONNECT
btstack: remove_encryption_state: conn_handle=64
btstack: find_encryption_state: conn_handle=64
btstack:   --> iter state 64
btstack: remove_active_connection: conn_handle=64
btstack: find_active_connection: conn_handle=64
btstack:   --> iter conn 64
btstack: att_write_callback (handle: 0, mode: 3, offset: 0, buffer: 0, size: 0)
btstack: att_write_callback handle not found
btstack: btstack_packet_handler_att_server(packet_type=4, packet=20081b74)
btstack:   --> att disconnected
btstack: btstack_packet_handler_att_server(packet_type=4, packet=20003ee4)
btstack:   --> hci att server event type: le_meta/disconnection (0x05)
btstack: btstack_packet_handler_generic(packet_type=4, packet=20081bbc)
btstack:   --> btstack # conns changed
btstack: mp_bluetooth_deinit
btstack: mp_bluetooth_gap_advertise_stop
btstack: btstack_packet_handler_generic(packet_type=4, packet=20081d14)
btstack:   --> btstack event state 0x03
btstack: btstack_packet_handler_generic(packet_type=4, packet=20081d14)
btstack:   --> btstack event state 0x03
btstack: mp_bluetooth_deinit: complete
--- /tmp/tmp4rsf07pz	2025-06-12 17:38:01.633401289 +1000
+++ /tmp/tmpgvvtkuf5	2025-06-12 17:38:01.633401289 +1000
@@ -5,13 +5,486 @@
 _IRQ_GATTS_READ_REQUEST
 _IRQ_CENTRAL_DISCONNECT
 --- instance1 ---
+btstack: mp_bluetooth_init
+btstack: mp_bluetooth_deinit
+btstack: Configuring TLV for automatic ER/IR key generation
+btstack: TLV_GET: tag=0x42544400 buffer_size=60
+btstack: TLV_GET: tag not found
+btstack: TLV_GET: tag=0x42544401 buffer_size=60
+btstack: TLV_GET: tag not found
+btstack: TLV_GET: tag=0x42544402 buffer_size=60
+btstack: TLV_GET: tag not found
+btstack: TLV_GET: tag=0x42544403 buffer_size=60
+btstack: TLV_GET: tag not found
+btstack: TLV_GET: tag=0x42544404 buffer_size=60
+btstack: TLV_GET: tag not found
+btstack: TLV_GET: tag=0x42544405 buffer_size=60
+btstack: TLV_GET: tag not found
+btstack: TLV_GET: tag=0x42544406 buffer_size=60
+btstack: TLV_GET: tag not found
+btstack: TLV_GET: tag=0x42544407 buffer_size=60
+btstack: TLV_GET: tag not found
+btstack: TLV_GET: tag=0x42544408 buffer_size=60
+btstack: TLV_GET: tag not found
+btstack: TLV_GET: tag=0x42544409 buffer_size=60
+btstack: TLV_GET: tag not found
+btstack: TLV_GET: tag=0x4254440a buffer_size=60
+btstack: TLV_GET: tag not found
+btstack: TLV_GET: tag=0x4254440b buffer_size=60
+btstack: TLV_GET: tag not found
+btstack: TLV_GET: tag=0x4254440c buffer_size=60
+btstack: TLV_GET: tag not found
+btstack: TLV_GET: tag=0x4254440d buffer_size=60
+btstack: TLV_GET: tag not found
+btstack: TLV_GET: tag=0x4254440e buffer_size=60
+btstack: TLV_GET: tag not found
+btstack: TLV_GET: tag=0x4254440f buffer_size=60
+btstack: TLV_GET: tag not found
+btstack: mp_bluetooth_init: waiting for stack startup
+btstack: btstack_packet_handler_generic(packet_type=4, packet=20081dcc)
+btstack:   --> btstack event state 0x01
+btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
+btstack:   --> hci transport packet sent
+btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
+btstack:   --> hci command complete
+btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
+btstack:   --> hci transport packet sent
+btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
+btstack:   --> hci command complete
+btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
+btstack:   --> hci transport packet sent
+btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
+btstack:   --> hci command complete
+btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
+btstack:   --> hci transport packet sent
+btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
+btstack:   --> hci command complete
+btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
+btstack:   --> hci transport packet sent
+btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
+btstack:   --> hci command complete
+btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
+btstack:   --> hci transport packet sent
+btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
+btstack:   --> hci command complete
+btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
+btstack:   --> hci transport packet sent
+btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
+btstack:   --> hci command complete
+btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
+btstack:   --> hci transport packet sent
+btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
+btstack:   --> hci command complete
+btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
+btstack:   --> hci transport packet sent
+btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
+btstack:   --> hci command complete
+btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
+btstack:   --> hci transport packet sent
+btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
+btstack:   --> hci command complete
+btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
+btstack:   --> hci transport packet sent
+btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
+btstack:   --> hci command complete
+btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
+btstack:   --> hci transport packet sent
+btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
+btstack:   --> hci command complete
+btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
+btstack:   --> hci transport packet sent
+btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
+btstack:   --> hci command complete
+btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
+btstack:   --> hci transport packet sent
+btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
+btstack:   --> hci command complete
+btstack: TLV_GET: tag=0x534d4552 buffer_size=16
+btstack: TLV_GET: tag not found
+btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
+btstack:   --> hci transport packet sent
+btstack: btstack_packet_handler_generic(packet_type=4, packet=20081d6c)
+btstack:   --> btstack event state 0x02
+btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
+btstack:   --> hci transport packet sent
+btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
+btstack:   --> hci command complete
+btstack: TLV_STORE: tag=0x534d4552, size=16
+btstack: TLV_STORE: data:btstack:  d7btstack:  98btstack:  53btstack:  c3btstack:  56btstack:  26btstack:  afbtstack:  d5btstack:  48btstack:  2ebtstack:  fbbtstack:  9cbtstack:  fdbtstack:  15btstack:  8abtstack:  c0btstack:
+DEBUG: mp_bluetooth_gap_on_set_secret called: type=0, key_len=4, value_len=16
+DEBUG: invoke_irq_handler returned mp_const_none (no handler registered) - returning true for default behavior
+btstack: TLV_STORE: success
+btstack: TLV_GET: tag=0x534d4952 buffer_size=16
+btstack: TLV_GET: tag not found
+btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
+btstack:   --> hci transport packet sent
+btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
+btstack:   --> hci command complete
+btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
+btstack:   --> hci transport packet sent
+btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
+btstack:   --> hci command complete
+btstack: TLV_STORE: tag=0x534d4952, size=16
+btstack: TLV_STORE: data:btstack:  6bbtstack:  f5btstack:  32btstack:  5cbtstack:  a1btstack:  ebbtstack:  18btstack:  8abtstack:  2ebtstack:  21btstack:  6abtstack:  f9btstack:  b1btstack:  12btstack:  fcbtstack:  e0btstack:
+DEBUG: mp_bluetooth_gap_on_set_secret called: type=0, key_len=4, value_len=16
+DEBUG: invoke_irq_handler returned mp_const_none (no handler registered) - returning true for default behavior
+btstack: TLV_STORE: success
+btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
+btstack:   --> hci command complete
+btstack: mp_bluetooth_init: stack startup complete
+btstack: set_public_address: Using controller's public address.
+btstack: mp_bluetooth_gatts_register_service_begin
+btstack: mp_bluetooth_gatts_register_service_end
+btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
+btstack:   --> hci transport packet sent
 gap_connect
+btstack: mp_bluetooth_gap_peripheral_connect
+btstack:   --> btstack error: 0
+btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
+btstack:   --> hci command complete
+btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
+btstack:   --> hci transport packet sent
+btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
+btstack:   --> hci transport packet sent
+btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
+btstack:   --> hci command status
+btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
+btstack:   --> hci command complete
+btstack: btstack_packet_handler_generic(packet_type=4, packet=20081bbc)
+btstack:   --> btstack # conns changed
+btstack: btstack_packet_handler_security(packet_type=4, packet=20081afc)
+btstack:   --> security event type: 0xcd
+btstack: btstack_packet_handler_generic(packet_type=4, packet=20081afc)
+btstack:   --> hci event type: unknown (0xcd)
+btstack: TLV_GET: tag=0x42544400 buffer_size=60
+btstack: TLV_GET: tag not found
+btstack: TLV_GET: tag=0x42544401 buffer_size=60
+btstack: TLV_GET: tag not found
+btstack: TLV_GET: tag=0x42544402 buffer_size=60
+btstack: TLV_GET: tag not found
+btstack: TLV_GET: tag=0x42544403 buffer_size=60
+btstack: TLV_GET: tag not found
+btstack: TLV_GET: tag=0x42544404 buffer_size=60
+btstack: TLV_GET: tag not found
+btstack: TLV_GET: tag=0x42544405 buffer_size=60
+btstack: TLV_GET: tag not found
+btstack: TLV_GET: tag=0x42544406 buffer_size=60
+btstack: TLV_GET: tag not found
+btstack: TLV_GET: tag=0x42544407 buffer_size=60
+btstack: TLV_GET: tag not found
+btstack: TLV_GET: tag=0x42544408 buffer_size=60
+btstack: TLV_GET: tag not found
+btstack: TLV_GET: tag=0x42544409 buffer_size=60
+btstack: TLV_GET: tag not found
+btstack: TLV_GET: tag=0x4254440a buffer_size=60
+btstack: TLV_GET: tag not found
+btstack: TLV_GET: tag=0x4254440b buffer_size=60
+btstack: TLV_GET: tag not found
+btstack: TLV_GET: tag=0x4254440c buffer_size=60
+btstack: TLV_GET: tag not found
+btstack: TLV_GET: tag=0x4254440d buffer_size=60
+btstack: TLV_GET: tag not found
+btstack: TLV_GET: tag=0x4254440e buffer_size=60
+btstack: TLV_GET: tag not found
+btstack: TLV_GET: tag=0x4254440f buffer_size=60
+btstack: TLV_GET: tag not found
+btstack: btstack_packet_handler_security(packet_type=4, packet=20081afc)
+btstack:   --> security event type: 0xce
+btstack: btstack_packet_handler_generic(packet_type=4, packet=20081afc)
+btstack:   --> hci event type: unknown (0xce)
+btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
+btstack:   --> hci le meta
+btstack: create_active_connection: conn_handle=64
 _IRQ_PERIPHERAL_CONNECT
+btstack: btstack_packet_handler_att_server(packet_type=4, packet=20003ee4)
+btstack:   --> hci att server event type: le_meta/disconnection (0x3e)
+btstack: btstack_packet_handler_att_server(packet_type=4, packet=20081b74)
+btstack:   --> att connected
+btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
+btstack:   --> hci transport packet sent
+btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
+btstack:   --> hci le meta
+btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
+btstack:   --> hci command status
+btstack: mp_bluetooth_gattc_discover_characteristics
+btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
+btstack:   --> hci transport packet sent
+btstack:   --> btstack error: 0
+btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
+btstack:   --> hci le meta
+btstack:   --> gatt characteristic query result
+btstack:   --> gatt characteristic query result
+btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
+btstack:   --> hci transport packet sent
+btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
+btstack:   --> hci number of completed packets
+btstack:   --> gatt characteristic query result
+btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
+btstack:   --> hci transport packet sent
+btstack:   --> gatt characteristic query result
 _IRQ_GATTC_CHARACTERISTIC_RESULT UUID('00000000-1111-2222-3333-444444444444')
+btstack:   --> gatt query characteristics complete conn_handle=64 status=0
 _IRQ_GATTC_CHARACTERISTIC_DONE
 gap_pair
+btstack: mp_bluetooth_gap_pair: conn_handle=64
+btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
+btstack:   --> hci transport packet sent
+btstack: btstack_packet_handler_security(packet_type=4, packet=20081bbc)
+btstack:   --> security event type: 0xd4
+btstack: btstack_packet_handler_generic(packet_type=4, packet=20081bbc)
+btstack:   --> enc/auth/pair/bond change (type=0xd4)
+btstack: find_active_connection: conn_handle=64
+btstack:   --> iter conn 64
+btstack:   --> updated conn state: encrypted=0, bonded=0
+btstack:   --> skipping intermediate encryption event (event_type=212)
+btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
+btstack:   --> hci number of completed packets
+btstack: btstack_packet_handler_security(packet_type=4, packet=20081b24)
+btstack:   --> security event type: 0xc8
+btstack: btstack_packet_handler_generic(packet_type=4, packet=20081b24)
+btstack:   --> just works request, auto-accepting
+btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
+btstack:   --> hci transport packet sent
+btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
+btstack:   --> hci transport packet sent
+btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
+btstack:   --> hci command complete
+btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
+btstack:   --> hci command complete
+btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
+btstack:   --> hci transport packet sent
+btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
+btstack:   --> hci transport packet sent
+btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
+btstack:   --> hci command complete
+btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
+btstack:   --> hci command complete
+btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
+btstack:   --> hci transport packet sent
+btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
+btstack:   --> hci transport packet sent
+btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
+btstack:   --> hci number of completed packets
+btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
+btstack:   --> hci transport packet sent
+btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
+btstack:   --> hci transport packet sent
+btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
+btstack:   --> hci command complete
+btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
+btstack:   --> hci transport packet sent
+btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
+btstack:   --> hci command complete
+btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
+btstack:   --> hci command complete
+btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
+btstack:   --> hci transport packet sent
+btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
+btstack:   --> hci command status
+btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
+btstack:   --> enc/auth/pair/bond change (type=0x08)
+btstack: find_active_connection: conn_handle=64
+btstack:   --> iter conn 64
+btstack:   --> updated conn state: encrypted=1, bonded=0
+btstack:   --> skipping intermediate encryption event (event_type=8)
+btstack: TLV_GET: tag=0x42544400 buffer_size=60
+btstack: TLV_GET: tag not found
+btstack: TLV_GET: tag=0x42544401 buffer_size=60
+btstack: TLV_GET: tag not found
+btstack: TLV_GET: tag=0x42544402 buffer_size=60
+btstack: TLV_GET: tag not found
+btstack: TLV_GET: tag=0x42544403 buffer_size=60
+btstack: TLV_GET: tag not found
+btstack: TLV_GET: tag=0x42544404 buffer_size=60
+btstack: TLV_GET: tag not found
+btstack: TLV_GET: tag=0x42544405 buffer_size=60
+btstack: TLV_GET: tag not found
+btstack: TLV_GET: tag=0x42544406 buffer_size=60
+btstack: TLV_GET: tag not found
+btstack: TLV_GET: tag=0x42544407 buffer_size=60
+btstack: TLV_GET: tag not found
+btstack: TLV_GET: tag=0x42544408 buffer_size=60
+btstack: TLV_GET: tag not found
+btstack: TLV_GET: tag=0x42544409 buffer_size=60
+btstack: TLV_GET: tag not found
+btstack: TLV_GET: tag=0x4254440a buffer_size=60
+btstack: TLV_GET: tag not found
+btstack: TLV_GET: tag=0x4254440b buffer_size=60
+btstack: TLV_GET: tag not found
+btstack: TLV_GET: tag=0x4254440c buffer_size=60
+btstack: TLV_GET: tag not found
+btstack: TLV_GET: tag=0x4254440d buffer_size=60
+btstack: TLV_GET: tag not found
+btstack: TLV_GET: tag=0x4254440e buffer_size=60
+btstack: TLV_GET: tag not found
+btstack: TLV_GET: tag=0x4254440f buffer_size=60
+btstack: TLV_GET: tag not found
+btstack: TLV_GET: tag=0x42544400 buffer_size=60
+btstack: TLV_GET: tag not found
+btstack: TLV_GET: tag=0x42544401 buffer_size=60
+btstack: TLV_GET: tag not found
+btstack: TLV_GET: tag=0x42544402 buffer_size=60
+btstack: TLV_GET: tag not found
+btstack: TLV_GET: tag=0x42544403 buffer_size=60
+btstack: TLV_GET: tag not found
+btstack: TLV_GET: tag=0x42544404 buffer_size=60
+btstack: TLV_GET: tag not found
+btstack: TLV_GET: tag=0x42544405 buffer_size=60
+btstack: TLV_GET: tag not found
+btstack: TLV_GET: tag=0x42544406 buffer_size=60
+btstack: TLV_GET: tag not found
+btstack: TLV_GET: tag=0x42544407 buffer_size=60
+btstack: TLV_GET: tag not found
+btstack: TLV_GET: tag=0x42544408 buffer_size=60
+btstack: TLV_GET: tag not found
+btstack: TLV_GET: tag=0x42544409 buffer_size=60
+btstack: TLV_GET: tag not found
+btstack: TLV_GET: tag=0x4254440a buffer_size=60
+btstack: TLV_GET: tag not found
+btstack: TLV_GET: tag=0x4254440b buffer_size=60
+btstack: TLV_GET: tag not found
+btstack: TLV_GET: tag=0x4254440c buffer_size=60
+btstack: TLV_GET: tag not found
+btstack: TLV_GET: tag=0x4254440d buffer_size=60
+btstack: TLV_GET: tag not found
+btstack: TLV_GET: tag=0x4254440e buffer_size=60
+btstack: TLV_GET: tag not found
+btstack: TLV_GET: tag=0x4254440f buffer_size=60
+btstack: TLV_GET: tag not found
+btstack: TLV_GET: tag=0x42544400 buffer_size=60
+btstack: TLV_GET: tag not found
+btstack: TLV_GET: tag=0x42544401 buffer_size=60
+btstack: TLV_GET: tag not found
+btstack: TLV_GET: tag=0x42544402 buffer_size=60
+btstack: TLV_GET: tag not found
+btstack: TLV_GET: tag=0x42544403 buffer_size=60
+btstack: TLV_GET: tag not found
+btstack: TLV_GET: tag=0x42544404 buffer_size=60
+btstack: TLV_GET: tag not found
+btstack: TLV_GET: tag=0x42544405 buffer_size=60
+btstack: TLV_GET: tag not found
+btstack: TLV_GET: tag=0x42544406 buffer_size=60
+btstack: TLV_GET: tag not found
+btstack: TLV_GET: tag=0x42544407 buffer_size=60
+btstack: TLV_GET: tag not found
+btstack: TLV_GET: tag=0x42544408 buffer_size=60
+btstack: TLV_GET: tag not found
+btstack: TLV_GET: tag=0x42544409 buffer_size=60
+btstack: TLV_GET: tag not found
+btstack: TLV_GET: tag=0x4254440a buffer_size=60
+btstack: TLV_GET: tag not found
+btstack: TLV_GET: tag=0x4254440b buffer_size=60
+btstack: TLV_GET: tag not found
+btstack: TLV_GET: tag=0x4254440c buffer_size=60
+btstack: TLV_GET: tag not found
+btstack: TLV_GET: tag=0x4254440d buffer_size=60
+btstack: TLV_GET: tag not found
+btstack: TLV_GET: tag=0x4254440e buffer_size=60
+btstack: TLV_GET: tag not found
+btstack: TLV_GET: tag=0x4254440f buffer_size=60
+btstack: TLV_GET: tag not found
+btstack: TLV_STORE: tag=0x4254440f, size=60
+btstack: TLV_STORE: data:btstack:  01btstack:  00btstack:  00btstack:  00btstack:  00btstack:  00btstack:  00btstack:  00btstack:  02btstack:  22btstack:  32btstack:  07btstack:  22btstack:  aebtstack:  b8btstack:  1ebtstack: ...btstack:
+DEBUG: mp_bluetooth_gap_on_set_secret called: type=0, key_len=4, value_len=60
+DEBUG: invoke_irq_handler returned: 1e, is_true: 1
+btstack: TLV_STORE: success
+btstack: TLV_GET: tag=0x4254440f buffer_size=60
+btstack: TLV_GET: found zu bytes:btstack:  01btstack:  00btstack:  00btstack:  00btstack:  00btstack:  00btstack:  00btstack:  00btstack:  02btstack:  22btstack:  32btstack:  07btstack:  22btstack:  aebtstack:  b8btstack:  1ebtstack: ...btstack:
+btstack: btstack_packet_handler_security(packet_type=4, packet=20081ac4)
+btstack:   --> security event type: 0xd3
+btstack: btstack_packet_handler_generic(packet_type=4, packet=20081ac4)
+btstack:   --> hci event type: unknown (0xd3)
+btstack: TLV_GET: tag=0x4254440f buffer_size=60
+btstack: TLV_GET: found zu bytes:btstack:  01btstack:  00btstack:  00btstack:  00btstack:  00btstack:  00btstack:  00btstack:  00btstack:  02btstack:  22btstack:  32btstack:  07btstack:  22btstack:  aebtstack:  b8btstack:  1ebtstack: ...btstack:
+btstack: TLV_STORE: tag=0x4254440f, size=60
+btstack: TLV_STORE: data:btstack:  01btstack:  00btstack:  00btstack:  00btstack:  00btstack:  00btstack:  00btstack:  00btstack:  02btstack:  22btstack:  32btstack:  07btstack:  22btstack:  aebtstack:  b8btstack:  1ebtstack: ...btstack:
+DEBUG: mp_bluetooth_gap_on_set_secret called: type=0, key_len=4, value_len=60
+DEBUG: invoke_irq_handler returned: 1e, is_true: 1
+btstack: TLV_STORE: success
+btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
+btstack:   --> hci transport packet sent
+btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
+btstack:   --> hci transport packet sent
+btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
+btstack:   --> hci command complete
+btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
+btstack:   --> hci command complete
+btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
+btstack:   --> hci transport packet sent
+btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
+btstack:   --> hci transport packet sent
+btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
+btstack:   --> hci command complete
+btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
+btstack:   --> hci transport packet sent
+btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
+btstack:   --> hci command complete
+btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
+btstack:   --> hci command complete
+btstack: btstack_packet_handler_security(packet_type=4, packet=200816b0)
+btstack:   --> security event type: 0xd5
+btstack: btstack_packet_handler_generic(packet_type=4, packet=200816b0)
+btstack:   --> enc/auth/pair/bond change (type=0xd5)
+btstack: find_active_connection: conn_handle=64
+btstack:   --> iter conn 64
+btstack:   --> updated conn state: encrypted=1, bonded=1
+btstack: find_encryption_state: conn_handle=64
+btstack: create_encryption_state: conn_handle=64
+btstack:   --> pairing complete, forwarding final encryption state to Python
 _IRQ_ENCRYPTION_UPDATE 1 0 1
+btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
+btstack:   --> hci transport packet sent
+btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
+btstack:   --> hci transport packet sent
+btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
+btstack:   --> hci transport packet sent
+btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
+btstack:   --> hci transport packet sent
 gattc_read
+btstack: mp_bluetooth_gattc_read
+btstack: find_active_connection: conn_handle=64
+btstack:   --> iter conn 64
+btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
+btstack:   --> hci transport packet sent
+btstack:   --> btstack error: 0
+btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
+btstack:   --> hci number of completed packets
+btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
+btstack:   --> hci number of completed packets
+btstack:   --> gatt characteristic value query result
 _IRQ_GATTC_READ_RESULT b'encrypted'
+btstack:   --> gatt query read complete conn_handle=64 status=0
+btstack: find_active_connection: conn_handle=64
+btstack:   --> iter conn 64
+btstack: mp_bluetooth_gap_disconnect
+btstack: btstack_packet_handler_generic(packet_type=4, packet=20001668)
+btstack:   --> hci transport packet sent
 gap_disconnect: True
+btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
+btstack:   --> hci command status
+btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
+btstack:   --> hci number of completed packets
+btstack: btstack_packet_handler_generic(packet_type=4, packet=20003ee4)
+btstack:   --> hci disconnect complete
 _IRQ_PERIPHERAL_DISCONNECT
+btstack: remove_encryption_state: conn_handle=64
+btstack: find_encryption_state: conn_handle=64
+btstack:   --> iter state 64
+btstack: remove_active_connection: conn_handle=64
+btstack: find_active_connection: conn_handle=64
+btstack:   --> iter conn 64
+btstack: att_write_callback (handle: 0, mode: 3, offset: 0, buffer: 0, size: 0)
+btstack: att_write_callback handle not found
+btstack: btstack_packet_handler_att_server(packet_type=4, packet=20081b74)
+btstack:   --> att disconnected
+btstack: btstack_packet_handler_att_server(packet_type=4, packet=20003ee4)
+btstack:   --> hci att server event type: le_meta/disconnection (0x05)
+btstack: btstack_packet_handler_generic(packet_type=4, packet=20081bbc)
+btstack:   --> btstack # conns changed
+btstack: mp_bluetooth_deinit
+btstack: mp_bluetooth_gap_advertise_stop
+btstack: btstack_packet_handler_generic(packet_type=4, packet=20081d14)
+btstack:   --> btstack event state 0x03
+btstack: btstack_packet_handler_generic(packet_type=4, packet=20081d14)
+btstack:   --> btstack event state 0x03
+btstack: mp_bluetooth_deinit: complete
### TRUTH ###
--- instance0 ---
gap_advertise
_IRQ_CENTRAL_CONNECT
_IRQ_ENCRYPTION_UPDATE 1 0 1
_IRQ_GATTS_READ_REQUEST
_IRQ_CENTRAL_DISCONNECT
--- instance1 ---
gap_connect
_IRQ_PERIPHERAL_CONNECT
_IRQ_GATTC_CHARACTERISTIC_RESULT UUID('00000000-1111-2222-3333-444444444444')
_IRQ_GATTC_CHARACTERISTIC_DONE
gap_pair
_IRQ_ENCRYPTION_UPDATE 1 0 1
gattc_read
_IRQ_GATTC_READ_RESULT b'encrypted'
gap_disconnect: True
_IRQ_PERIPHERAL_DISCONNECT
### DIFF ###
1 tests performed
0 tests passed
1 tests failed: ./tests/multi_bluetooth/ble_gap_pair_bond.py
